---
description: Core architecture rules for this Next.js + Payload CMS template
alwaysApply: true
---

# Project Architecture Rules

## Stack (Strict)
- **Framework:** Next.js 15+ (App Router)
- **CMS:** Payload CMS 3.0 (native Node, embedded in Next.js)
- **Database:** PostgreSQL
- **Styling:** Tailwind CSS (utility classes, avoid arbitrary values)
- **Animations:** GSAP (ScrollTrigger for scroll-based, timeline for sequenced)
- **Language:** TypeScript (strict mode)
- **Icons:** Lucide React

## Template Purpose
This is a **reusable boilerplate** for landing pages and marketing sites. The home page (`(frontend)/page.tsx`) is a static showcase. CMS-powered pages use the block-based page builder via the catch-all route.

## Block-Based Page Builder
1. **CMS:** `Pages` collection with a `layout` blocks field
2. **Frontend:** Catch-all route `[...slug]/page.tsx` fetches by slug with `depth: 2`
3. **Rendering:** `<RenderBlocks />` maps block types to React components

## Coding Rules
- **Payload schemas** go in `src/collections/` and `src/blocks/*/schema.ts`
- **Block components** go in `src/blocks/*/Component.tsx`
- **Shared components** go in `src/components/` (layout, ui, animations)
- **Type safety:** Run `npm run generate:types` after schema changes. Use generated types.
- **Server Components by default.** Only add `'use client'` for interactive islands and animations.
- **Data fetching:** Always use Payload Local API with `depth: 2` so upload fields resolve to full objects.
- **Styling:** Tailwind utility classes only. Stick to the design system.

## Animation Rules
- Import GSAP utilities from `@/lib/gsap` (pre-registers ScrollTrigger)
- Use `<AnimatedSection>` for scroll-triggered reveals on sections
- Use `trigger="load"` on AnimatedSection for above-the-fold content
- Only add `'use client'` to components that need GSAP or interactivity
- Keep animations subtle: 0.8-1s duration, `power3.out` easing, modest transforms

## Adding a New Block
1. Create `src/blocks/YourBlock/schema.ts` (Payload Block config)
2. Create `src/blocks/YourBlock/Component.tsx` (React component)
3. Register the block in `src/collections/Pages.ts` `layout.blocks` array
4. Register the component in `src/blocks/RenderBlocks.tsx` map
5. Run `npm run generate:types`
